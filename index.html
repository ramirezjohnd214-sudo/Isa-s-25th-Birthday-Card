<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Happy 25th Birthday, Isa!!!</title>
<link rel="preconnect" href="https://www.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500&family=Indie+Flower&display=swap" rel="stylesheet">
<style>
  :root{
    --skyTop:#08182a;        /* deep indigo */
    --skyBottom:#0c2743;     /* lighter indigo */
    --glow:#ffffffd0;
    --accent:#7dd3fc;
    --grass:#0e1b22;
    --ui:#0b1220cc;
    --gold:#ffd166;
    --danger:#ff6b6b;
  }
  html,body{height:100%;margin:0;background:linear-gradient(to bottom,var(--skyTop),var(--skyBottom));color:#e6f1ff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;overflow:hidden}
  /* BACKGROUND ART */
  /* Full-bleed blurred fill */
.bg-fill{
  position:fixed; inset:0; z-index:1; pointer-events:none;
  width:100%; height:100%;
  object-fit:cover;       /* fills the screen */
  filter: blur(24px) brightness(.75) saturate(1.1);
  transform: scale(1.05); /* hide blur edges */
}

/* Crisp full artwork on top, uncropped */
.bg-img{
  position:fixed; inset:0; z-index:1; pointer-events:none;
  width:100%; height:100%;
  object-fit:contain;     /* shows the entire 1536x1024 image */
  image-rendering:auto;
}
  /* CANVAS STARS */
  #star-canvas{position:fixed;inset:0;z-index:0;pointer-events:none;}
  /* INTERACTIVE STAR LAYER (DOM) */
  #message-layer{position:fixed;inset:0;z-index:2;pointer-events:none;}
  /* Add this keyframes block (anywhere in <style>) */
@keyframes twinklePulse {
  0%   { transform: scale(1);   box-shadow: 0 0 10px 2px #ffffffd0, 0 0 2px 1px #fff; opacity: 0.9; }
  50% { transform: scale(1.3);
      box-shadow: 0 0 25px 7px #ffffffee, 0 0 4px 2px #fff;
      opacity: 1; }
  100% { transform: scale(1);   box-shadow: 0 0 10px 2px #ffffffd0, 0 0 2px 1px #fff; opacity: 0.9; }
}
@keyframes sparkleBurst {
  0% { transform: scale(0); opacity: 0.8; box-shadow: 0 0 10px 4px #fff; }
  50% { transform: scale(2.5); opacity: 1; box-shadow: 0 0 20px 8px #fff, 0 0 40px 12px #ffd700; }
  100% { transform: scale(0); opacity: 0; box-shadow: none; }
}
.sparkle {
  position: absolute;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #fff;
  pointer-events: none;
  animation: sparkleBurst 0.9s ease-out forwards;
}
/* Update your .mstar rules */
.mstar{
  position:absolute; width:8px; height:8px; border-radius:50%;
  background:#fff; cursor:pointer; pointer-events:auto;
  /* existing glow (keep): */
  box-shadow:0 0 10px 2px var(--glow), 0 0 2px 1px #fff;

  /* smooth hover still works */
  transition:transform .12s;

  /* NEW: twinkle animation (duration customizable via CSS var) */
  animation: twinklePulse var(--dur, 2.8s) ease-in-out infinite;
}

/* Keep your hover behavior */
.mstar:hover{ transform: scale(1.5); }
.tooltip {
  position: absolute;
  transform: translate(-50%, -160%);
  padding: 0.35rem 0.6rem;
  background: rgba(0, 0, 0, 0.6);
  border: 1px solid rgba(255, 255, 255, 0.35);
  border-radius: 6px;
  color: #fff;
  font-size: 0.75rem;
  font-family: "Quicksand", sans-serif;
  white-space: nowrap;
  pointer-events: none;
  backdrop-filter: blur(4px);
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.25s ease, transform 0.25s ease;
}
@keyframes tooltipGlow {
  0% {
    box-shadow: 0 0 6px rgba(255, 255, 255, 0.4),
                0 0 12px rgba(125, 211, 252, 0.2);
  }
  50% {
    box-shadow: 0 0 14px rgba(255, 255, 255, 0.8),
                0 0 28px rgba(125, 211, 252, 0.6),
                0 0 45px rgba(255, 255, 255, 0.3);
  }
  100% {
    box-shadow: 0 0 6px rgba(255, 255, 255, 0.4),
                0 0 12px rgba(125, 211, 252, 0.2);
  }
}

/* add glow effect when hovering on star */
.mstar:hover .tooltip {
  opacity: 1;
  visibility: visible;
  transform: translate(-50%, -180%);
  animation: tooltipGlow 2.5s ease-in-out infinite;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translate(-50%, -150%) scale(0.9); }
  to { opacity: 1; transform: translate(-50%, -160%) scale(1); }
}
  /* UI BAR */
  /* Smaller, floating HUD in the top-right */
.hud {
  position:fixed;
  top:1rem;
  right:1rem;
  z-index:5;

  background:var(--ui);
  border:1px solid #ffffff24;
  backdrop-filter:blur(6px);

  border-radius:12px;
  padding:.6rem .8rem;

  display:flex;
  flex-direction:column;
  gap:.5rem;

  max-width:220px;
  width:max-content;
}

/* Title smaller, no huge bar */
.hud-title {
  font-size:.9rem;
  font-weight:600;
  color:#e6f1ff;
  margin:0;
  line-height:1.2;
  text-wrap:balance;
}

/* Stack buttons vertically on mobile */
.hud-buttons {
  display:flex;
  flex-wrap:wrap;
  gap:.5rem;
}

.hud-buttons button {
  flex:1 1 auto;
  white-space:nowrap;
  font-size:.8rem;
  line-height:1.2;
  padding:.5rem .6rem;
  border-radius:10px;
}

/* Remove pills since we're not showing message count anymore */
.pill { display:none!important; }

/* Remove giant CTA at the bottom if you want the bottom bar gone too */
.cta { display:none!important; }

@media (min-width:600px){
  .hud {
    max-width:none;
    width:auto;
  }
  .hud-buttons {
    flex-wrap:nowrap;
  }
  .hud-buttons button {
    flex:0 0 auto;
  }
}
  button, .btn{
    background:#111933; color:#e6f1ff; border:1px solid #ffffff28; border-radius:10px; padding:.5rem .75rem; font-weight:600; cursor:pointer;
  }
  button:hover{filter:brightness(1.2)}
  .ghost{background:transparent}
  .accent{border-color:#7dd3fc50}
  .danger{border-color:#ff6b6b70;color:#ffb3b3}
  /* FOOTER CTA */
  .cta{
    position:fixed; left:50%; bottom:1rem; transform:translateX(-50%);
    z-index:3; display:flex; gap:.5rem; align-items:center; background:var(--ui);
    border:1px solid #ffffff24; padding:.6rem .8rem; border-radius:12px; backdrop-filter:blur(6px)
  }
  /* MODALS */
  dialog{border:none; border-radius:16px; background:#0b1220f2; color:#e6f1ff; padding:1.25rem; width:min(520px,92vw)}
  dialog::backdrop{background:rgba(0,0,0,.5)}
  .field{display:grid; gap:.35rem; margin:.6rem 0}
  input[type="text"], input[type="email"], input[type="password"], textarea{
    width:100%; background:#0f1830; color:#e6f1ff; border:1px solid #ffffff24; border-radius:10px; padding:.55rem .7rem;
  }
  textarea{min-height:100px; resize:vertical}
  .row{display:flex; gap:.5rem; align-items:center; flex-wrap:wrap}
  .muted{opacity:.7;font-size:.9rem}
  .pill{padding:.2rem .5rem; border:1px solid #ffffff28; border-radius:999px; font-size:.75rem}
  .admin{color:#b4f5c6; border-color:#b4f5c680}
  .notice{position:fixed; left:50%; top:calc(1rem + 58px); transform:translateX(-50%); z-index:5; background:#101b33; border:1px solid #ffffff24; padding:.5rem .8rem; border-radius:10px; display:none}
  @media (max-width:700px){ .hud{gap:.35rem} .cta{left:50%; transform:translateX(-50%);}}
  
.hud {
  left:auto;
  right:1rem;
  max-width:220px;
  width:auto;
  display:flex;
  flex-direction:column;
}
.hud.compact {
  position: fixed;
  top: 1rem;
  right: 1rem;
  z-index: 5;
  background: rgba(0,0,0,0.4);
  border: 1px solid rgba(255,255,255,0.2);
  border-radius: 12px;
  padding: .8rem;
  backdrop-filter: blur(6px);
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: .4rem;
  width: fit-content;
}

.hud.compact h1 {
  font-size: 0.9rem;
  font-weight: 600;
  margin: 0 0 .2rem 0;
  color: #fff;
}

.hud.compact button {
  font-size: 0.8rem;
  padding: 0.4rem 0.6rem;
  border-radius: 8px;
}
.hud.compact {
  position: fixed;
  top: 1rem;
  right: 1rem;
  z-index: 10;
  background: rgba(15, 20, 40, 0.7);
  border: 1px solid rgba(255, 255, 255, 0.35);
  border-radius: 12px;
  padding: 0.8rem 1rem;
  backdrop-filter: blur(12px);
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 0.5rem;
  color: #fff;
  box-shadow: 0 0 18px rgba(0, 0, 0, 0.6);
  transition: opacity 0.3s ease;
}

.hud.compact h1 {
  font-size: 1rem;
  font-weight: 600;
  color: #fff;
  margin: 0;
}
.hud.compact button {
  background: rgba(255, 255, 255, 0.15);
  color: #fff;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  font-size: 0.9rem;
  padding: 0.5rem 0.8rem;
  cursor: pointer;
  transition: background 0.2s ease, transform 0.1s ease;
}

.hud.compact button:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: scale(1.05);
}
.message-modal {
  border: none;
  border-radius: 12px;
  padding: 1.5rem;
  max-width: 400px;
  background: rgba(0, 0, 0, 0.85);
  color: #fff;
  backdrop-filter: blur(10px);
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.6);
  animation: fadeIn 0.3s ease;
}
/* --- Fun message modal styling --- */
.message-modal {
  border: none;
  border-radius: 16px;
  padding: 1.8rem;
  max-width: 420px;
  background: rgba(15, 20, 40, 0.85);
  color: #fff;
  backdrop-filter: blur(10px);
  box-shadow: 0 0 25px rgba(255, 255, 255, 0.3), 0 0 60px rgba(0, 150, 255, 0.1);
  font-family: "Indie Flower", cursive;
  text-align: center;
  animation: popIn 0.4s ease-out;
  transform-origin: center;
}
.message-modal h2 {
  font-size: 1.8rem;
  color: #ffda79;
  margin-bottom: 0.6rem;
  text-shadow: 0 0 10px rgba(255, 255, 200, 0.8);
}
.message-modal p {
  font-size: 1.2rem;
  line-height: 1.5;
  white-space: pre-wrap;
}
/* --- Sparkle pop-in animation for message modal --- */
@keyframes sparklePop {
  0% {
    opacity: 0;
    transform: scale(0.8) rotate(-2deg);
    box-shadow: 0 0 0px rgba(255,255,255,0);
  }
  40% {
    opacity: 1;
    transform: scale(1.05) rotate(1deg);
    box-shadow:
      0 0 20px rgba(255,255,255,0.7),
      0 0 40px rgba(255,215,0,0.4),
      0 0 60px rgba(125,211,252,0.3);
  }
  100% {
    opacity: 1;
    transform: scale(1) rotate(0);
    box-shadow:
      0 0 12px rgba(255,255,255,0.4),
      0 0 25px rgba(125,211,252,0.2);
  }
}

.message-modal {
  animation: sparklePop 0.8s ease-out;
  transition: transform 0.3s ease, box-shadow 0.5s ease;
}
/* Soft "pop-in" animation */
@keyframes popIn {
  from {
    transform: scale(0.8);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}
@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.9); }
  to { opacity: 1; transform: scale(1); }
}
/* --- Add Your Star button glow animation --- */
/* FORCE glowing Add Your Star button */
@keyframes pulseGlow {
  0% {
    box-shadow: 0 0 6px rgba(255, 255, 255, 0.4),
                0 0 12px rgba(255, 255, 255, 0.3),
                0 0 0px rgba(125, 211, 252, 0);
    transform: scale(1);
  }
  50% {
    box-shadow: 0 0 12px rgba(255, 255, 255, 0.8),
                0 0 25px rgba(125, 211, 252, 0.8),
                0 0 40px rgba(125, 211, 252, 0.4);
    transform: scale(1.08);
  }
  100% {
    box-shadow: 0 0 6px rgba(255, 255, 255, 0.4),
                0 0 12px rgba(255, 255, 255, 0.3),
                0 0 0px rgba(125, 211, 252, 0);
    transform: scale(1);
  }
}
#addBtn {
  position: relative;
  z-index: 1000;
  animation: pulseGlow 2.8s ease-in-out infinite !important;
  transition: transform 0.2s, filter 0.3s;
}
#addBtn:hover {
  transform: scale(1.12);
  filter: brightness(1.3);
}
/* --- Shooting Star Animation --- */
/* --- Shooting Star Animation (fixed visibility) --- */
@keyframes shootingStar {
  0% {
    transform: translate(0, 0) scale(1);
    opacity: 1;
  }
  100% {
    transform: translate(-2000px, 800px) scale(0.8);
    opacity: 0;
  }
}

.shooting-star {
  position: fixed;
  width: 3px;
  height: 3px;
  background: white;
box-shadow: 0 0 25px 8px rgba(255,255,255,0.95),
            0 0 80px 20px rgba(255,255,255,0.7);

  border-radius: 50%;
  z-index: 9999; /* ensure it's above all layers */
  opacity: 0;
  animation: shootingStar 1.4s linear forwards;
  pointer-events: none;
}
@keyframes shimmer {
  0%, 100% { filter: brightness(1) blur(0.5px); }
  50% { filter: brightness(1.5) blur(1px); }
}
.firework {
  position: fixed;
    width: 4px;
  height: 4px;
  border-radius: 50%;
  background: radial-gradient(circle, #fff 0%, #ffd700 70%, transparent 100%);
  pointer-events: none;
  animation: shootUp 2s ease-out forwards;
  z-index: 10;
  opacity: 0.9;
  box-shadow: 0 0 12px 3px rgba(255,255,255,0.9);
}

@keyframes shootUp {
  0% { transform: translateY(0); opacity: 1; }
  90% { opacity: 1; }
  100% { transform: translateY(-50vh); opacity: 0; }
}

.explosion {
  position: fixed;
  width: 3px;
  height: 3px;
  border-radius: 50%;
  pointer-events: none;
  animation: explode 1.8s ease-out forwards;
  mix-blend-mode: screen;
  z-index: 10;
}

@keyframes explode {
  0% { transform: scale(0.8); opacity: 1; }
  100% { transform: scale(1.3) translate(var(--x), var(--y)); opacity: 0; }
}
/* Ensure message stars stay visible above fireworks */
#message-layer {
  z-index: 20;
}
/* --- Glittering Comet Trail --- */
.trail {
  position: fixed;
  width: 2px;
  height: 2px;
  border-radius: 50%;
  background: radial-gradient(circle, #fff 0%, #ffd700 60%, transparent 100%);
  pointer-events: none;
  opacity: 0.8;
  animation: trailFade 1s ease-out forwards;
  mix-blend-mode: screen;
  z-index: 8;
  box-shadow: 0 0 8px 2px rgba(255, 255, 255, 0.9);
}

@keyframes trailFade {
  0%   { opacity: 0.9; transform: scale(1); }
  50%  { opacity: 0.5; transform: scale(0.8); }
  100% { opacity: 0; transform: scale(0.5); }
}
/* ✨ Magical star cursor when placing a star */
body.placing-star {
  cursor: url('https://cdn-icons-png.flaticon.com/512/616/616408.png') 16 16, crosshair;
}
/* ✨ Floating magical notice ✨ */
#notice {
  position: fixed;
  top: 1.5rem;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(15, 20, 40, 0.8);
  color: #fff;
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 10px;
  padding: 0.6rem 1rem;
  font-size: 1rem;
  font-family: "Quicksand", sans-serif;
  text-shadow: 0 0 8px #fff;
  opacity: 0;
  pointer-events: none;
  backdrop-filter: blur(8px);
  box-shadow: 0 0 15px rgba(255,255,255,0.3);
  transition: opacity 0.6s ease, transform 0.6s ease;
  z-index: 99999;
}

#notice.show {
  opacity: 1;
  transform: translateX(-50%) scale(1.05);
}

/* ✨ Emoji Picker Styling ✨ */
.emoji-picker {
  display: flex;
  flex-wrap: wrap;
  gap: 0.4rem;
  font-size: 1.6rem;
  user-select: none;
  justify-content: center;
  margin-top: 0.5rem;
}

.emoji-picker span {
  cursor: pointer;
  transition: transform 0.2s ease;
}

.emoji-picker span:hover {
  transform: scale(1.25);
}

</style>
</head>
<body>
  <canvas id="star-canvas" aria-hidden="true"></canvas>
  <img class="bg-fill" src="IsaBday.png" alt="" aria-hidden="true" loading="eager" />
  <img class="bg-img"  src="IsaBday.png" alt="" aria-hidden="true" loading="eager" />

  <div id="message-layer"></div>

  <div class="hud compact" role="toolbar">
  <h1>✨ Add your star for Isa</h1>
  <button id="addBtn" class="accent">Add Your Star ✨</button>
  <button id="loginBtn" class="ghost">Admin</button>
  <button id="logoutBtn" class="ghost" style="display:none">Sign out</button>
</div>

  <div class="cta">
    <span class="muted">Tip: click the sky to place your star</span>
  </div>

<<<<<<< HEAD
<!-- 🌟 Add Star Modal -->
<dialog id="addModal">
  <form id="addForm">
    <h2>Add Your Star ✨</h2>

    <div class="field">
      <label>Your Name</label>
      <input id="nameInput" maxlength="40" required placeholder="Your name" />
    </div>

    <div class="field">
      <label>Message</label>
      <textarea id="msgInput" maxlength="300" required placeholder="Write a sweet note…"></textarea>

      <!-- ✨ Emoji Picker -->
      <div class="emoji-picker" id="emojiPicker">
        🌟 🎂 🎈 💖 🥳 ✨ 🎶 💫 ❤️ 🧡 💛 💚 💙 💜 🤎 🖤 🤍 💗 💓 💞 💕 💘 💝 🌈 🎉 🥰
=======
  <!-- Add Star Modal -->
  <dialog id="addModal">
    <form id="addForm" method="dialog">
      <h3>Add your star ✨</h3>
      <p class="muted">You clicked at: <span id="coordsText">x0,y0</span>. Enter your name & message.</p>
      <div class="field">
        <label>Name</label>
        <input id="nameInput" maxlength="40" required placeholder="Your name">
      </div>
      <div class="field">
  <label>Message</label>
  <textarea id="msgInput" maxlength="300" required placeholder="Write a sweet note…"></textarea>
  
  <!-- ✨ Emoji Picker -->
  <div class="emoji-picker" id="emojiPicker">
    🌟 🎂 🎈 💖 🥳 ✨ 🎶 💫 ❤️ 🧡 💛 💚 💙 💜 🤎 🖤 🤍 💗 💓 💞 💕 💘 💝 🌈 🎉 🥰
  </div>
</div>
      <div class="row">
        <button type="submit" class="accent">Save Star</button>
        <button type="button" id="cancelAdd" class="ghost">Cancel</button>
>>>>>>> 1e07ded1a499999d384716f0e0e979775acc714e
      </div>
    </div>

    <menu>
      <button id="cancelAdd" type="button">Cancel</button>
      <button id="saveStar" type="submit" class="accent">Save Star</button>
    </menu>
  </form>
</dialog>

<!-- ✨ Notice message -->
<div id="notice">Click the sky to place your star ✨</div>

  <!-- View/Edit Modal -->
  <dialog id="viewModal" class="message-modal">
  <div id="viewContent"></div>
  <div class="row" style="margin-top:.75rem">
    <button id="closeView" class="ghost">Close</button>
    <div class="spacer"></div>
    <button id="editBtn" class="ghost" style="display:none">Edit</button>
    <button id="deleteBtn" class="danger" style="display:none">Delete</button>
  </div>
</dialog>

  <!-- Edit Modal -->
  <dialog id="editModal">
    <form id="editForm" method="dialog">
      <h3>Edit message</h3>
      <div class="field">
        <label>Name</label>
        <input id="editName" maxlength="40" required>
      </div>
      <div class="field">
        <label>Message</label>
        <textarea id="editMsg" maxlength="300" required></textarea>
      </div>
      <div class="row">
        <button type="submit" class="accent">Save</button>
        <button type="button" id="cancelEdit" class="ghost">Cancel</button>
      </div>
    </form>
  </dialog>

  <!-- Admin Login -->
  <dialog id="adminModal">
    <form id="adminForm" method="dialog">
      <h3>Admin sign in</h3>
      <p class="muted">Admins can edit or delete stars and export/import.</p>
      <div class="field">
        <label>Email</label>
        <input id="adminEmail" type="email" placeholder="admin@example.com" required>
      </div>
      <div class="field">
        <label>Password</label>
        <input id="adminPass" type="password" required value="isasings111">
      </div>
      <div class="row">
        <button type="submit" class="accent">Sign in</button>
        <button type="button" id="cancelAdmin" class="ghost">Cancel</button>
      </div>
      <div class="row" style="margin-top:.5rem; gap:.4rem">
        <button type="button" id="exportBtn" class="ghost" style="display:none">Export JSON</button>
        <label class="btn ghost" style="display:none" id="importLabel">Import JSON<input id="importFile" type="file" accept="application/json" hidden></label>
      </div>
    </form>
  </dialog>

  <!-- Firebase (modular v10) -->
<script type="module">
  /* ===== Starfield Background ===== */
  const canvas = document.getElementById('star-canvas');
  const ctx = canvas.getContext('2d', { alpha: true });
  let W = innerWidth, H = innerHeight;
  canvas.width = W; canvas.height = H;

  const stars = Array.from({ length: 5000 }, () => ({
    x: Math.random() * W,
    y: Math.random() * H * 0.9,
    r: Math.random() * 1.1 + 0.2,
    tw: Math.random() * Math.PI * 2,
    sp: 0.002 + Math.random() * 0.004
  }));

  function drawStars() {
    ctx.clearRect(0, 0, W, H);
    for (const s of stars) {
      s.tw += s.sp;
      const a = 0.25 + 0.75 * (0.5 + 0.5 * Math.sin(s.tw));
      ctx.globalAlpha = a;
      ctx.beginPath();
      ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
      ctx.fillStyle = '#fff';
      ctx.fill();
    }
    requestAnimationFrame(drawStars);
  }
  addEventListener('resize', () => {
    W = innerWidth; H = innerHeight; canvas.width = W; canvas.height = H;
  });
  drawStars();

  /* ===== Disney-style Arcing Fireworks ===== */
function createFirework() {
  const fw = document.createElement("div");
  fw.className = "firework";

  const depth = Math.random();
  let scale, opacity, heightMult;

  if (depth < 0.3) { scale = 0.4; opacity = 0.6; heightMult = 0.7; }
  else if (depth < 0.7) { scale = 0.7; opacity = 0.8; heightMult = 0.85; }
  else { scale = 1.0; opacity = 1.0; heightMult = 1.0; }

 const startX = Math.random() * window.innerWidth;
 const startY = window.innerHeight * 0.55; // launch slightly above grass

 // 🎇 Aim explosions toward the center of the screen
 const centerX = window.innerWidth / 2;
const peakY = window.innerHeight * (0.3 + Math.random() * 0.1);
 // arc slightly toward the center
 const arcX = centerX + (startX - centerX) * 0.3 + (Math.random() - 0.5) * 100;

  fw.style.left = `${startX}px`;
  fw.style.bottom = `${startY}px`;
  fw.style.transform = `scale(${scale})`;
  fw.style.opacity = opacity;

  document.body.appendChild(fw);

  // Animate curved trajectory
  fw.animate(
    [
      { transform: `translate(0, 0) scale(${scale})`, opacity: 1 },
      { transform: `translate(${(arcX - startX) * 0.5}px, -${(startY - peakY) / 2}px) scale(${scale * 1.1})`, opacity: 1 },
      { transform: `translate(${arcX - startX}px, -${startY - peakY}px) scale(${scale * 0.8})`, opacity: 0.6 }
    ],
    { duration: 1800, easing: "ease-out" }
  ).onfinish = () => {
    fw.remove();
    createExplosion(arcX, peakY, scale);
  };
}
function createExplosion(x, y, scale = 1) {
  const colors = [
    "#ffd700", "#ff69b4", "#00ffff", "#ffffff",
    "#ffa500", "#adff2f", "#87cefa", "#ffb6c1"
  ];

  const sparks = 60 + Math.floor(Math.random() * 40); // 🌟 more sparks
  const spread = 200 * scale + Math.random() * 150 * scale; // 🌟 wider spread
  const duration = 2200 + Math.random() * 1000; // 🌟 linger longer

  for (let i = 0; i < sparks; i++) {
    const s = document.createElement("div");
    s.className = "explosion";
    s.style.left = `${x}px`;
    s.style.top = `${y}px`;
    s.style.background = colors[Math.floor(Math.random() * colors.length)];
    s.style.width = `${2 + Math.random() * 4 * scale}px`;
    s.style.height = s.style.width;
    s.style.boxShadow = `0 0 ${12 + 10 * scale}px ${s.style.background}`;
    s.style.setProperty("--x", `${(Math.random() - 0.5) * spread}px`);
    s.style.setProperty("--y", `${(Math.random() - 0.5) * spread}px`);
    s.style.opacity = 0.9;
    s.style.animationDuration = `${duration}ms`;
    s.style.animationName = "explode, shimmer";
    s.style.animationTimingFunction = "ease-out, linear";
    s.style.animationIterationCount = "1, infinite";
    document.body.appendChild(s);
    setTimeout(() => s.remove(), duration);
  }
}

// 🎇 Launch every 5 seconds, sometimes a double-burst
setInterval(() => {
  createFirework();
  if (Math.random() < 0.5) setTimeout(createFirework, 1000 + Math.random() * 1500);
}, 5000);

// Start one immediately for testing
createFirework();
/* ===== Firebase Star Logic (restored) ===== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyADhhtFZZcRMOwqU_dwR7RMHITYsfvXDUY",
  authDomain: "isa-s-25th-birthday.firebaseapp.com",
  projectId: "isa-s-25th-birthday",
  storageBucket: "isa-s-25th-birthday.firebasestorage.app",
  messagingSenderId: "590841309751",
  appId: "1:590841309751:web:bb444deda0263f1b9fedb2"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const layer = document.getElementById("message-layer");
const addModal = document.getElementById("addModal");
const addForm = document.getElementById("addForm");
const viewModal = document.getElementById("viewModal");
const viewContent = document.getElementById("viewContent");
const addBtn = document.getElementById("addBtn");
const cancelAdd = document.getElementById("cancelAdd");
/* === Name validation: letters only === */
const nameInput = document.getElementById("nameInput");
nameInput.addEventListener("input", () => {
  nameInput.value = nameInput.value.replace(/[^a-zA-Z\s]/g, "");
});

/* === Emoji Picker Logic === */
const emojiPicker = document.getElementById("emojiPicker");
const msgInput = document.getElementById("msgInput");

emojiPicker.addEventListener("click", (e) => {
  if (e.target.tagName === "SPAN") {
    const emoji = e.target.textContent;
    const start = msgInput.selectionStart;
    const end = msgInput.selectionEnd;
    msgInput.value =
      msgInput.value.substring(0, start) + emoji + msgInput.value.substring(end);
    msgInput.focus();
    msgInput.selectionEnd = start + emoji.length;
  }
});

// Allow user to click anywhere in the sky to choose star position
let currentX = 0, currentY = 0;
let admin = false;
let isPlacing = false; // only one declaration!

// === Add Star Button ===
addBtn.onclick = () => {
  isPlacing = true;
  document.body.classList.add("placing-star");

  const notice = document.getElementById("notice");
  notice.textContent = "Click the sky to place your star ✨";
  notice.style.display = "block";
  notice.classList.add("show");

  setTimeout(() => {
    if (isPlacing) notice.classList.add("show");
  }, 50);
};

// === Handle star placement click ===
document.addEventListener("click", (e) => {
  if (!isPlacing) return; // only respond in "Add Star" mode
  if (e.target.closest("button, dialog, .mstar, .tooltip")) return; // ignore UI & stars

  isPlacing = false;
const notice = document.getElementById("notice");
notice.classList.remove("show");
notice.style.display = "none";
document.body.classList.remove("placing-star");

  currentX = e.clientX;
  currentY = e.clientY;
  document.getElementById("coordsText").textContent =
    `x${Math.round(currentX)}, y${Math.round(currentY)}`;

  addModal.showModal(); // open star form
});

cancelAdd.onclick = () => addModal.close();

addForm.onsubmit = async (e) => {
  e.preventDefault();
  const name = document.getElementById("nameInput").value.trim();
  const message = document.getElementById("msgInput").value.trim();

  if (!name || !message) {
    alert("Please enter both your name and a message ✨");
    return;
  }

  await addDoc(collection(db, "messages"), { name, message, x: currentX, y: currentY });
  addModal.close();
  renderStars();
};
  // Reset picker
  selectedEmojis = [];
  document.querySelectorAll("#emojiPicker .selected").forEach(el => el.classList.remove("selected"));

/* === Display Stars === */
async function renderStars() {
  layer.innerHTML = "";
  const snapshot = await getDocs(collection(db, "messages"));
  snapshot.forEach(docSnap => {
    const data = docSnap.data();
    const el = document.createElement("div");
    el.className = "mstar";
    el.style.left = `${data.x}px`;
    el.style.top = `${data.y}px`;
    el.onclick = () => openView(docSnap.id, data);

    const tip = document.createElement("div");
    tip.className = "tooltip";
    tip.textContent = `${data.emojis || "🌟"} ${data.name}`;
    el.appendChild(tip);
    layer.appendChild(el);
  });
}

function openView(id, data) {
  viewContent.innerHTML = `<h2>${data.emojis || "🌟"} ${data.name}</h2><p>${data.message}</p>`;
  const editBtn = document.getElementById("editBtn");
  const deleteBtn = document.getElementById("deleteBtn");

  // Only show Edit/Delete for admins
  if (admin) {
    editBtn.style.display = "inline-block";
    deleteBtn.style.display = "inline-block";
  } else {
    editBtn.style.display = "none";
    deleteBtn.style.display = "none";
  }

  editBtn.onclick = () => {
    viewModal.close();
    document.getElementById("editName").value = data.name;
    document.getElementById("editMsg").value = data.message;
    editModal.showModal();

    document.getElementById("editForm").onsubmit = async (e) => {
      e.preventDefault();
      await updateDoc(doc(db, "messages", id), {
        name: document.getElementById("editName").value.trim(),
        message: document.getElementById("editMsg").value.trim()
      });
      editModal.close();
      renderStars();
    };
  };
deleteBtn.onclick = async () => {
  if (!admin) {
    alert("You must be signed in as admin to delete.");
    return;
  }
  if (confirm("Are you sure you want to delete this star?")) {
    try {
      await deleteDoc(doc(db, "messages", id));
      alert("🌟 Star deleted successfully!");
      viewModal.close();
      renderStars();
    } catch (err) {
      alert("❌ Failed to delete: " + err.message);
      console.error(err);
    }
  }
};
  viewModal.showModal();
}

document.getElementById("closeView").onclick = () => viewModal.close();

renderStars();
/* === Admin Login === */
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const adminModal = document.getElementById("adminModal");
const adminForm = document.getElementById("adminForm");
const cancelAdmin = document.getElementById("cancelAdmin");

loginBtn.onclick = () => adminModal.showModal();
cancelAdmin.onclick = () => adminModal.close();

adminForm.onsubmit = async (e) => {
  e.preventDefault();
  const email = document.getElementById("adminEmail").value;
  const pass = document.getElementById("adminPass").value;
  try {
    await signInWithEmailAndPassword(auth, email, pass);
    admin = true;
    adminModal.close();
    loginBtn.style.display = "none";
    logoutBtn.style.display = "inline-block";
    alert("✅ Admin signed in!");
  } catch (err) {
    alert("❌ Login failed: " + err.message);
  }
};

logoutBtn.onclick = async () => {
  await signOut(auth);
  admin = false;
  logoutBtn.style.display = "none";
  loginBtn.style.display = "inline-block";
  alert("Signed out.");
};
// ✅ Firebase connection check
try {
  console.log("🔥 Checking Firebase connection...");
  const test = await getDocs(collection(db, "messages"));
  console.log(`✅ Firebase connected successfully! Found ${test.size} messages.`);
} catch (err) {
  console.error("❌ Firebase connection failed:", err);
  alert("Firebase connection error — check your credentials in the console.");
}
</script>
</body>
</html>